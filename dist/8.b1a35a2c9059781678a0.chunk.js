webpackJsonp([8],{673:function(e,t,a){var i=a(34)(a(732),a(781),null,null);i.options.__file="E:\\workspace\\temp\\attendance-system\\src\\views\\pages\\leave.vue",i.esModule&&Object.keys(i.esModule).some(function(e){return"default"!==e&&"__esModule"!==e})&&console.error("named exports are not supported in *.vue files."),i.options.functional&&console.error("[vue-loader] leave.vue: functional components are not supported with templates, they should use render functions."),e.exports=i.exports},680:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(250),r=function(e){return e&&e.__esModule?e:{default:e}}(i),l={env:r.default,devBaseUrl:"http://172.17.43.55:3000/api"};t.default=l},732:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(101),l=i(r),n=a(680),o=i(n),s=a(56),p=i(s);t.default={data:function(){var e=this;return{currStaffData:{},immediateLeaderId:null,applicationData:{id:null,name:"",userName:"",department:"",immediateLeader:"",immediateLeaderId:null,leaveDateBegin:"",leaveDateEnd:"",successor:"",leaveReason:"",leaveType:""},hasSubmit:!1,columns:[{title:"姓名",key:"name",align:"center"},{title:"申请时间",key:"applicationDate",width:140,align:"center"},{title:"请假日期",key:"leaveDate",align:"center"},{title:"请假原因",key:"leaveReason",align:"center"},{title:"审批进度",key:"progress",align:"center"},{title:"操作",key:"action",width:130,align:"center",render:function(t,a){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.show(a.index)}}},"查看"),t("Poptip",{props:{confirm:!0,title:"确认删除此条申请？",transfer:!0},on:{"on-ok":function(){e.del(a.row._id)}}},[t("Button",{props:{type:"error",size:"small",placement:"top"}},"删除")])])}}],tableData:[{name:"刘奇",applicationDate:"2017-10-27 10:27:00",progressCode:"主管已批"},{name:"刘奇",applicationDate:"2017-10-27 10:27:00",progressCode:"已审批"},{name:"刘奇",applicationDate:"2017-10-27 10:27:00",progressCode:"待审批"}],columns2:[{type:"selection",width:40,align:"center"},{title:"姓名",key:"name",align:"center"},{title:"部门",key:"department",align:"center"},{title:"申请时间",key:"applicationDate",align:"center",width:140},{title:"请假日期",key:"leaveDate",align:"center"},{title:"请假原因",key:"leaveReason",align:"center"},{title:"操作",key:"action",align:"center",width:130,render:function(t,a){return t("div",[t("Poptip",{props:{confirm:!0,title:"确认同意申请？",transfer:!0},on:{"on-ok":function(){e.agreeApplication(a.row._id,a.row.role)}}},[t("Button",{props:{type:"primary",size:"small",placement:"top"},style:{marginRight:"5px"}},"同意")]),t("Poptip",{props:{confirm:!0,title:"拒绝申请？",transfer:!0},on:{"on-ok":function(){e.refuseApplication(a.row._id,a.row.role)}}},[t("Button",{props:{type:"error",size:"small",placement:"top"}},"拒绝")])])}}],tableData2:[{name:"刘奇",department:"前端组",applicationDate:"10-27 12:34",leaveDate:"10/28 09:00 10/28 18:00",leaveReason:"修车"}],columns3:[{title:"姓名",key:"name",align:"center"},{title:"部门",key:"department",align:"center"},{title:"申请时间",key:"applicationDate",align:"center",width:140},{title:"请假日期",key:"leaveDate",align:"center"},{title:"请假原因",key:"leaveReason",align:"center"},{title:"状态",key:"action",alicn:"center"}],tableData3:[],rules:{leaveDateBegin:[{required:!0,type:"date",message:"请选择开始时间",trigger:"blur"}],leaveDateEnd:[{required:!0,type:"date",message:"请选择结束时间",trigger:"blur"}],leaveReason:[{required:!0,message:"请填写请假理由",trigger:"blur"},{type:"string"}],successor:[{required:!0,message:"请填写工作承接人",trigger:"blur"}],leaveType:[{required:!0,message:"请选择请假类型",trigger:"blur"}]}}},computed:{},methods:{init:function(){var e=this;(0,l.default)({url:o.default.devBaseUrl+"/staff/query",params:{id:this.getCurrentStaffId()}}).then(function(t){if(1==t.data.status){var a=t.data.result.list[0],i={};i.id=a.id,i.name=a.name,i.userName=a.userName,i.department=a.department,i.immediateLeaderId=a.immediateLeaderId,i.immediateLeader=a.immediateLeader,i.role=a.role,e.applicationData=i,console.log(i)}else alert(t.data.msg)}).catch(function(e){console.log(e)})},handleSubmit:function(){var e=this,t=0;for(var a in this.applicationData)this.applicationData[a]&&t++;console.log(t),12===t?(this.applicationData.applicationDate=p.default.formatDate("yyyy-MM-dd hh:mm:ss",(new Date).getTime()),this.applicationData.type=1,l.default.post(o.default.devBaseUrl+"/application/addApplication",this.applicationData).then(function(t){1===t.data.status&&(e.$Message.success(t.data.msg),e.queryRecord())}).catch(function(e){console.log(e.message)})):this.$Message.error("提交信息有误")},queryRecord:function(){var e=this;l.default.get(o.default.devBaseUrl+"/application/queryRecord?id="+this.getCurrentStaffId()+"&type=1&pageSize=5").then(function(t){if(1==t.data.status){t.data.result.list.forEach(function(e){switch(e.applicationDate=p.default.formatDate("MM-dd hh:mm",parseInt(e.applicationDate)),e.leaveDate=p.default.formatDate("MM-dd hh:mm",e.leaveDateBegin)+" / "+p.default.formatDate("MM-dd hh:mm",e.leaveDateEnd),e.leaveProgress){case 1:e.progress="待主管审批";break;case 2:e.progress="待总监审批";break;case 3:e.progress="审批通过";break;case 0:e.progress="审批被拒绝"}}),e.tableData=t.data.result.list}else e.tableData=[]})},queryNotApprove:function(){var e=this;l.default.post(o.default.devBaseUrl+"/application/queryNotApprove",{id:this.getCurrentStaffId(),role:this.getCurrentRole()}).then(function(t){if(1===t.data.status){var a=t.data.result.list;a.forEach(function(e){e.applicationDate=p.default.formatDate("MM-dd hh:mm",parseInt(e.applicationDate)),e.leaveDate=p.default.formatDate("MM-dd hh:mm",e.leaveDateBegin)+" / "+p.default.formatDate("MM-dd hh:mm",e.leaveDateEnd)}),e.tableData2=a}})},queryApprove:function(){var e=this;l.default.post(o.default.devBaseUrl+"/application/queryApprove",{id:this.getCurrentStaffId(),role:this.getCurrentRole()}).then(function(t){if(1===t.data.status){var a=t.data.result.list;a.forEach(function(e){switch(e.applicationDate=p.default.formatDate("MM-dd hh:mm",parseInt(e.applicationDate)),e.leaveDate=p.default.formatDate("MM-dd hh:mm",e.leaveDateBegin)+" / "+p.default.formatDate("MM-dd hh:mm",e.leaveDateEnd),e.leaveProgress){case 0:e.action="未通过";break;case 3:e.action="已通过";break;default:e.action="审批中"}}),e.tableData3=a}})},getCurrentStaffId:function(){return sessionStorage.getItem("id")},getCurrentRole:function(){return sessionStorage.getItem("role")},show:function(e){},del:function(e){var t=this;l.default.post(o.default.devBaseUrl+"/application/delApplication",{_id:e}).then(function(e){1===e.data.status?(t.$Message.success(e.data.msg),t.queryRecord()):t.$Message.error(e.data.msg)})},leaveDateBeginChange:function(e){this.applicationData.leaveDateBegin=e},leaveDateEndChange:function(e){this.applicationData.leaveDateEnd=e},agreeApplication:function(e,t,a){var i=this;l.default.post(o.default.devBaseUrl+"/application/approve",{_id:e,role:this.getCurrentRole(),action:1}).then(function(e){1===e.data.status&&(i.$Message.success(e.data.msg),i.queryNotApprove(),i.queryApprove())})},refuseApplication:function(e,t,a){var i=this;l.default.post(o.default.devBaseUrl+"/application/approve",{_id:e,role:this.getCurrentRole(),action:0}).then(function(e){1===e.data.status&&(i.$Message.success(e.data.msg),i.queryNotApprove(),i.queryApprove())})}},mounted:function(){this.init(),this.queryRecord(),this.queryNotApprove(),this.queryApprove()}}},781:function(e,t,a){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Row",[a("Col",{attrs:{span:"10"}},[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"clipboard"}}),e._v("\n                    调休申请\n                ")],1),e._v(" "),a("Form",{ref:"applicationData",attrs:{"label-width":100,model:e.applicationData,rules:e.rules}},[a("FormItem",{attrs:{label:"申请人：",prop:"name"}},[a("Input",{staticStyle:{width:"200px"},attrs:{type:"text",placeholder:"申请人",disabled:""},model:{value:e.applicationData.name,callback:function(t){e.$set(e.applicationData,"name",t)},expression:"applicationData.name"}})],1),e._v(" "),a("FormItem",{attrs:{label:"部门："}},[a("Input",{staticStyle:{width:"200px"},attrs:{type:"text",placeholder:"请选择部门",disabled:""},model:{value:e.applicationData.department,callback:function(t){e.$set(e.applicationData,"department",t)},expression:"applicationData.department"}})],1),e._v(" "),a("FormItem",{attrs:{label:"开始时间：",required:"",prop:"leaveDateBegin"}},[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始时间"},on:{"on-change":e.leaveDateBeginChange}})],1),e._v(" "),a("FormItem",{attrs:{label:"结束时间：",required:""}},[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束时间"},on:{"on-change":e.leaveDateEndChange}})],1),e._v(" "),a("FormItem",{attrs:{label:"工作承接人：",required:"",prop:"successor"}},[a("Input",{staticStyle:{width:"200px"},attrs:{type:"text",placeholder:""},model:{value:e.applicationData.successor,callback:function(t){e.$set(e.applicationData,"successor",t)},expression:"applicationData.successor"}})],1),e._v(" "),a("FormItem",{attrs:{label:"请假理由：",required:"",prop:"leaveReason"}},[a("Input",{staticStyle:{width:"200px"},attrs:{type:"textarea",placeholder:""},model:{value:e.applicationData.leaveReason,callback:function(t){e.$set(e.applicationData,"leaveReason",t)},expression:"applicationData.leaveReason"}})],1),e._v(" "),a("FormItem",{attrs:{label:"请假类型：",required:"",prop:"leaveType"}},[a("RadioGroup",{model:{value:e.applicationData.leaveType,callback:function(t){e.$set(e.applicationData,"leaveType",t)},expression:"applicationData.leaveType"}},[a("Radio",{attrs:{label:"调休",value:"1"}}),e._v(" "),a("Radio",{attrs:{label:"事假",value:"2"}}),e._v(" "),a("Radio",{attrs:{label:"病假",value:"3"}}),e._v(" "),a("Radio",{attrs:{label:"婚假",value:"4"}})],1)],1),e._v(" "),a("FormItem",{attrs:{label:"审批人："}},[a("Input",{staticStyle:{width:"200px"},attrs:{type:"text",placeholder:"审批人",disabled:""},model:{value:e.applicationData.immediateLeader,callback:function(t){e.$set(e.applicationData,"immediateLeader",t)},expression:"applicationData.immediateLeader"}})],1),e._v(" "),a("FormItem",{attrs:{label:""}},[a("Button",{staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("提交")])],1)],1)],1)],1),e._v(" "),a("Col",{staticClass:"padding-left-10",attrs:{span:"14"}},[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"clipboard"}}),e._v("\n                    审批进度\n                ")],1),e._v(" "),a("Row",[a("Table",{attrs:{columns:e.columns,data:e.tableData}})],1)],1),e._v(" "),a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"clipboard"}}),e._v("\n                    待审批列表\n                ")],1),e._v(" "),a("Row",[a("Table",{attrs:{columns:e.columns2,data:e.tableData2}})],1)],1),e._v(" "),a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"clipboard"}}),e._v("\n                    已审批列表\n                ")],1),e._v(" "),a("Row",[a("Table",{attrs:{columns:e.columns3,data:e.tableData3}})],1)],1)],1)],1),e._v(" "),a("br")],1)},staticRenderFns:[]},e.exports.render._withStripped=!0}});